<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link type="text/css" rel="stylesheet" href="http://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.css" />
    <link rel="stylesheet" href="./css/styles.css">
    <title>interactions magazine | Issue</title>
</head>

<body>
    <main>
        <div class="container">

            <template-header id="header" subtitle="" subtext=""></template-header>
            </template-header>

            <div class="row justify-content-center">
                <div class="col-12 col-md-10">
                    <div id="app">
                        <div v-for="(item, index) in items">
                            <div v-if="index == 0" class="mb-5" id="issue-title">
                                <h2 id="subtitle">Issue: {{ item['fields']['Target Issue'] }} {{ item['fields']['Target Year'] }}</h2>
                                <h3 v-if="dialogue">Dialogue: {{ dialogue }}</h3>
                                <p class="my-4 font-weight-light">List of provisional content for the {{ item['fields']['Target Issue'] }} {{ item['fields']['Target Year'] }} issue of the <a href="https://interactions.acm.org/" target="_blank">ACM interactions magazine</a>. Details are
                                    subject to change.</p>
                            </div>
                        </div>

                        <template>
                            <b-table striped hover responsive small bordered head-variant="dark" :fields="fields" :items="items">
                                <template v-slot:cell(index)="data">{{ data.index + 1 }}</template>
                        <template v-slot:cell(Type)="data">{{ data.item.fields.Type }}</template>
                        <template v-slot:cell(primaryContact)="data">
                                    <span v-if="data.item['fields']['Primary Contact'] == 'Provisional/Planned Content'">TBA</span>
                                    <span v-else-if="data.item['fields']['Primary Contact']">{{ data.item['fields']['Primary Contact'] }}</span>
                                    <span v-else>TBA</span>
                                </template>
                        <template v-slot:cell(titleOfText)="data">{{ data.item['fields']['Title of text'] }}</template> -->
                        <template v-slot:cell(Status)="data">
                                    <b-badge variant="danger" v-if="data.item.fields.Status == 'Pending'">{{ data.item.fields.Status[0] }}</b-badge>
                                    <b-badge variant="warning" v-if="data.item.fields.Status == 'In process'">{{ data.item.fields.Status[0] }}</b-badge>
                                    <b-badge variant="success" v-if="data.item.fields.Status == 'Ready'">{{ data.item.fields.Status[0] }}</b-badge>
                                    <b-badge variant="secondary" v-if="data.item.fields.Status == 'Planning'">{{ data.item.fields.Status[0] }}</b-badge>
                                </template>
                        </b-table>
                        </template>

                        <!-- <table class="table table-hover table-striped table-sm">
                            <thead class="thead-dark">
                                <tr class="font-weight-bold">
                                    <th scope="col" class="text-left border-right" width="15%">Type</th>
                                    <th scope="col" class="text-center border-right" width="30%">Primary Author</th>
                                    <th scope="col" class="text-center" width="40%">Title</th>
                                    <th scope="col" class="text-right" width="40%">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="item in items" class="font-weight-light" v-show="item['fields']['Status'] != 'Cancelled'">
                                    <td class="text-left align-middle border-right" width="15%">
                                        <span>{{ item['fields']['Type'] }}</span>
                                    </td>
                                    <td class="text-center align-middle border-right" width="30%">
                                        <span v-if="item['fields']['Primary Contact'] == 'Provisional/Planned Content'">TBA</span>
                                        <span v-else-if="item['fields']['Primary Contact']">{{ item['fields']['Primary Contact'] }}</span>
                                        <span v-else>TBA</span>
                                    </td>
                                    <td class="text-center align-middle" width="45%">
                                        <span v-if="item['fields']['Title of text']">{{ item['fields']['Title of text'] }}</span>
                                        <span v-else>TBA</span>
                                    </td>
                                    <td class="text-right align-middle" width="10%">
                                        <span v-if="item['fields']['Status'] == 'Pending'" class="badge badge-danger">Pending</span>
                                        <span v-if="item['fields']['Status'] == 'In process'" class="badge badge-warning">In process</span>
                                        <span v-if="item['fields']['Status'] == 'Ready'" class="badge badge-success">Ready</span>
                                        <span v-if="item['fields']['Status'] == 'Planning'" class="badge badge-secondary">Planned</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table> -->
                    </div>
                </div>
            </div>
        </div>
    </main>
    <template-footer id="footer">
    </template-footer>
    <script src="http://unpkg.com/jquery@latest/dist/jquery.slim.min.js"></script>
    <script src="http://unpkg.com/bootstrap@latest/dist/js/bootstrap.bundle.min.js"></script>
    <script src="http://unpkg.com/vue@latest/dist/vue.min.js"></script>
    <script src="http://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.js"></script>
    <script src="https://unpkg.com/axios@latest/dist/axios.min.js"></script>
    <script src="http://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue-icons.min.js"></script>
    <script type="text/javascript" src="js/vue_components.js"></script>
    <script type="text/javascript" src="js/scripts.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $('[data-toggle="tooltip"]').tooltip();
        });
        var app_id = "appgcGlPwTaZaBImL";
        var app_key = "key8l5YZtQ9FyUoxF";
        var issue_view;

        var app = new Vue({
            el: '#app',
            data: {
                items: [],
                dialogue: '',
                fields: [{
                    key: 'index',
                    label: '',
                }, {
                    key: 'Type',
                    label: 'Type'
                }, {
                    key: 'primaryContact',
                    label: 'Primary Author'
                }, {
                    key: 'titleOfText',
                    label: 'Title'
                }, 'Status'],
                striped: true,
                bordered: true,
                small: true,
                hover: true,
                headVariant: 'dark'
            },
            mounted: function() {
                this.loadItems();
            },
            methods: {
                loadItems: function() {
                    let url = new URL(window.location.href);
                    // Get issue view
                    if (url.searchParams.get("view") == null) {
                        issue_view = encodeURIComponent("May/Jun 2020");
                    } else {
                        issue_view = url.searchParams.get("view");
                    }
                    if (url.searchParams.get("dialogue") == null) {
                        this.dialogue = null;
                    } else {
                        this.dialogue = url.searchParams.get("dialogue");
                    }
                    let submission_url = "https://api.airtable.com/v0/" + app_id + "/Content?view=" + issue_view + "&fields%5B%5D=Primary%20Contact&fields%5B%5D=Status&fields%5B%5D=Title%20of%20text&fields%5B%5D=Type&fields%5B%5D=Target%20Issue&fields%5B%5D=Target%20Year";
                    let self = this;
                    axios.get(
                        submission_url, {
                            headers: {
                                Authorization: "Bearer " + app_key
                            }
                        }
                    ).then(function(response) {
                        //console.log(self.issue);
                        self.items = response.data.records;
                        console.log(self.items);
                    }).catch(function(error) {
                        console.log(error);
                    })
                }
            }
        });
    </script>
</body>

</html>